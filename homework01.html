<!-- Generated with pandoc -D html
Modified by Matthew Elwin.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<title>ME495: Embedded Systems in Robotics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
</style>
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<style type="text/css">
/*
Matthew Elwin
css for the nume template for making websites

Contains code modified from with https://gist.github.com/killercup/5917178
Mostly using the aesthetics from above, but added a table of contents menu to the left.
When printing, the menu will be hidden

*/


nav#TOC{
    width: 20%;
    height: 100%;
    position:fixed!important;
    z-index:1;
    overflow:auto;
    padding-right: 2em;
}

.home_up{
    position: fixed;
    right: 0.25em;
    top: 0.25em;
}
.content{
    margin-left: 21%;
    padding-left: 4em;
}

.inner{
    margin: 0 auto;
    min-width: 30em;
    max-width: 50em;
}

.no-foot{
    min-height: 100vh 
}

.container:after,.container:before{content:"";display:table;clear:both}

.footer {
    font-size: 9pt
}

html {
  font-size: 100%;
  overflow-y: scroll;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  padding: 0;
}

body {
  font-family: "DejaVu Serif", Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
  font-size: 12px;
  line-height: 1.7;
  padding: 1em;
  background: #fefefe;
}

a {
  color: #0645ad;
  text-decoration: none;
}

a:visited {
  color: #0b0080;
}

nav a:visited {
    color: #0645ad;
}

a:hover {
  color: #06e;
}

nav a:hover {
    color: #0645ad;
    background: #C3C3DE
}

a:active {
  color: #faa700;
}

a:focus {
  outline: thin dotted;
}

*::-moz-selection {
  background: rgba(255, 255, 0, 0.3);
  color: #000;
}

*::selection {
  background: rgba(255, 255, 0, 0.3);
  color: #000;
}

a::-moz-selection {
  background: rgba(255, 255, 0, 0.3);
  color: #0645ad;
}

a::selection {
  background: rgba(255, 255, 0, 0.3);
  color: #0645ad;
}

p {
  margin: 1em 0;
}

img {
  max-width: 100%;
}

h1, h2, h3, h4, h5, h6 {
  color: #111;
  line-height: 125%;
  margin-top: 1em;
  font-weight: normal;
}

h4, h5, h6 {
  font-weight: bold;
}

h1 {
  font-size: 2.5em;
}

h1.title {
    margin-top: 0em;
    font-size: 3em;
}

h2 {
  font-size: 2em;
}

h3 {
  font-size: 1.5em;
}

h4 {
  font-size: 1.2em;
}

h5 {
  font-size: 1em;
}

h6 {
  font-size: 0.9em;
}

blockquote {
  color: #666666;
  margin: 0;
  padding-left: 3em;
  border-left: 0.5em #EEE solid;
}

hr {
  display: block;
  height: 2px;
  border: 0;
  border-top: 1px solid #aaa;
  border-bottom: 1px solid #eee;
  margin: 1em 0;
  padding: 0;
}

pre, code, kbd, samp {
    color: #000;
    background-color: #f0f0f0;
  border: 1px solid #e1e4e5;
  font-family: monospace, monospace;
  _font-family: 'courier new', monospace;
  font-size: 0.98em;
}

.line-block {
    color: #000;
    background-color: #f0f0f0;
    border: 1px solid #e1e4e5;
}
/* this style is used for inline code blocks 
it is overwridden when inside a pre format block*/
code {
    padding: 0 5px;
    white-space: nowrap;
    font-size: 85%
}

pre {
  white-space: pre;
  white-space: pre-wrap;
  word-wrap: break-word;
}

pre code {
    padding: 0 0;
    white-space: inherit;
    border: 0
}

b, strong {
  font-weight: bold;
}

dfn {
  font-style: italic;
}

ins {
  background: #ff9;
  color: #000;
  text-decoration: none;
}

mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

sub, sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

ul, ol {
  margin: 1em 0;
  padding: 0 0 0 2em;
}

li > ul, li > ol {
    margin: 0 0;
}

nav ul, nav ol {
    list-style: none;
    padding: 0 0 0 0;
}

/* make the top level list item in table of contents not indent*/
nav li > ul, nav li > ol {
    list-style: none;
    padding: 0 0 0 2em;
}

li p:last-child {
  margin-bottom: 0;
}

ul ul, ol ol {
  margin: .3em 0;
}

dl {
  margin-bottom: 1em;
}

dt {
  font-weight: bold;
  margin-bottom: .8em;
}

dd {
  margin: 0 0 .8em 2em;
}

dd:last-child {
  margin-bottom: 0;
}

img {
  border: 0;
  -ms-interpolation-mode: bicubic;
  vertical-align: middle;
}

figure {
  display: block;
  text-align: center;
  margin: 1em 0;
}

figure img {
  border: none;
  margin: 0 auto;
}

figcaption {
  font-size: 0.8em;
  font-style: italic;
  margin: 0 0 .8em;
}

table {
  margin-bottom: 2em;
  border-bottom: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-spacing: 0;
  border-collapse: collapse;
}

table th {
  padding: .2em 1em;
  background-color: #eee;
  border-top: 1px solid #ddd;
  border-left: 1px solid #ddd;
}

table td {
  padding: .2em 1em;
  border-top: 1px solid #ddd;
  border-left: 1px solid #ddd;
  vertical-align: top;
}

.author {
  font-size: 1.2em;
}

/* When the screen gets too narrow, hide the toc*/
@media only screen and (max-width: 768px) {
    nav {
        visibility: hidden
    }
    .content {
        margin-left: 0;
    }
}

@media only screen and (min-width: 480px) {
  body {
      font-size: 14px;
  }
}
@media only screen and (min-width: 768px) {
  body {
    font-size: 16px;
  }
}
@media print {
  * {
    background: transparent !important;
    color: black !important;
    filter: none !important;
    -ms-filter: none !important;
  }

  nav {
      visibility: hidden;
  }

  .content{
      margin-left: 0%;
      padding-left: 10px;
  }

  body {
    font-size: 10pt;
    max-width: 100%;
  }

  a, a:visited {
    text-decoration: underline;
  }

  hr {
    height: 1px;
    border: 0;
    border-bottom: 1px solid black;
  }

  a[href]:after {
    content: " (" attr(href) ")";
  }

  abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
    content: "";
  }

  pre, blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  tr, img {
    page-break-inside: avoid;
  }

  img {
    max-width: 100% !important;
  }

  @page :left {
    margin: 15mm 20mm 15mm 10mm;
}

  @page :right {
    margin: 15mm 10mm 15mm 20mm;
}

  p, h2, h3 {
    orphans: 3;
    widows: 3;
  }

  h2, h3 {
    page-break-after: avoid;
  }
}


</style>
</head>
<body>

<!-- Sidebar for table of contents -->
<nav id="TOC" role="doc-toc">
<h3>Table of Contents</h3>
<ul>
<li><a href="#logistics">Logistics</a><ul>
<li><a href="#setup-and-documentation">Setup and Documentation</a></li>
<li><a href="#git-usage">Git Usage</a></li>
<li><a href="#coding-guidelines">Coding Guidelines</a></li>
<li><a href="#submission-instructions">Submission Instructions</a></li>
<li><a href="#grading">Grading</a></li>
</ul></li>
<li><a href="#part-i-inspection">Part I: Inspection</a></li>
<li><a href="#part-ii-turtle-control">Part II: Turtle Control</a><ul>
<li><a href="#velocity-translator">Velocity Translator</a></li>
<li><a href="#turtle-waypoint">Turtle Waypoint</a></li>
</ul></li>
</ul>
</nav>

<nav class="home_up">
  <a href="index.html">Home</a>
</nav>
<div class="content">
  <div class="inner">
    <div class="no-foot">
<!-- Put the header to the right of the table of contents -->
<header id="title-block-header">
<h1 class="title">ME495: Embedded Systems in Robotics</h1>
</header>

<!-- The main content of the file -->
<h1 id="logistics">Logistics</h1>
<p>This homework is divided into two parts. In the first part you will clone an existing repository and examine it using ROS command line tools. In the second part you will write your own package to make a turtle follow a series of waypoints.</p>
<h2 id="setup-and-documentation">Setup and Documentation</h2>
<ol>
<li>Create a git repository using the link provided in Canvas. This repository will contain your <code>README.md</code> and the package you create.</li>
<li>Your <code>README.md</code> should contain the following:
<ol>
<li>YOUR FULL NAME.</li>
<li>Overview: A description of the package, listing what it does and how to use it.</li>
<li>Homework Questions: Answer the homework questions in your <code>README.md</code>. Subsections should follow the structure of this document and the answers should be clearly labeled with the corresponding question number.</li>
<li>Format your <code>README.md</code> using markdown: see <a href="https://guides.github.com/features/mastering-markdown/">this guide</a>. Some text editors like <code>atom</code> or <code>vscode</code> will preview markdown for you locally. You can also use tools like <code>markdown</code> or <code>pandoc</code> to generate <code>.html</code> from <code>.md</code> files.</li>
</ol></li>
<li>Each node that you write should start with a python docstring describing its ROS API:
<ol>
<li>What topics are published, their type, and what they do.</li>
<li>What topics are subscribed to, their type, and what the data is used for.</li>
<li>What services are offered, their type, and what they do</li>
<li>What parameters are used, their type, and what they do.</li>
<li>Take inspiration from <code>crazy_turtle/mover</code> (the package you will examine).</li>
</ol></li>
</ol>
<h2 id="git-usage">Git Usage</h2>
<p>During this assignment, pay close attention to how you use <code>git</code>.</p>
<ol>
<li>You should have multiple commits with meaningful commit messages.</li>
<li>For the purposes of this class, anytime you code something, try it out, and have fixed any obvious (to you) errors is a good time to commit.
<ul>
<li>Committing often frees you to experiment while knowing you can always revert the code.</li>
</ul></li>
<li>Maintain a <code>.gitignore</code> file to prevent improperly tracked files.
<ol>
<li>There should be no backup files your text editor created (such as <code>file.py~</code> or <code>.#file</code>).</li>
<li>There should be no python bytecode files (<code>file.pyc</code>) committed.</li>
<li>There should be no files that are not explicitly created by you as part of your package. There may be explicit exceptions to this for the purpose of submitting your results to me.</li>
</ol></li>
<li>Refer to the <a href="https://git-scm.com">Git Book</a> for more information on how to use <code>git.</code></li>
<li>I recommend sticking with the command line, at least until you are comfortable with <code>git.</code></li>
</ol>
<h2 id="coding-guidelines">Coding Guidelines</h2>
<ol>
<li>You are not permitted to use ANY global variables in your final submission.</li>
<li>You should try to follow the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> Style guidelines.</li>
<li>It is also a good habit to write docstrings for each of the classes and functions you write.
<ul>
<li>A brief description of what the class or function does</li>
<li>What the arguments are</li>
<li>What the return value is</li>
<li>What exceptions may be raised</li>
<li>See the <a href="http://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a> (specifically the section on docstrings).</li>
</ul></li>
</ol>
<h2 id="submission-instructions">Submission Instructions</h2>
<p>Push your package to the remote <code>git</code> repository that was created from the GitHub classroom link. Be sure your latest work is on the <code>master</code> branch.</p>
<h2 id="grading">Grading</h2>
<p>You will be graded based on</p>
<ol>
<li>Your source code working.</li>
<li>Your <code>README.md</code> and your answers to the questions.</li>
<li>The documentation you include in your source code.</li>
<li>Your git usage.</li>
</ol>
<h1 id="part-i-inspection">Part I: Inspection</h1>
<p>For each of the steps in the <em>Inspection</em> section, in addition to answering any questions posed, record the command that you entered (including any command-line arguments) in your <code>README.md</code>.</p>
<p>All of the questions can be answered with a single ROS command and a short phrase or sentence.</p>
<ol>
<li>Create a new ros workspace.</li>
<li>Use <code>wstool</code> to clone the <code>crazy_turtle</code> package from <code>https://github.com/m-elwin/crazy_turtle</code> into your source space.</li>
<li>Use <code>wstool</code> to clone your repository from GitHub into your sourcespace. You should maintain a <code>README.md</code> in this repository to answer these questions. Regardless of the repository name on GitHub, name it <code>turtle_control</code> when using <code>wstool</code>.
<ul>
<li>You should now have two separate git repositories in your source space: <code>crazy_turtle</code> and <code>turtle_control</code></li>
</ul></li>
<li>Build the workspace.</li>
<li>Source the devel space setup script.</li>
<li>Run the launchfile <code>go_crazy_turtle.launch</code>.</li>
<li>Use a ROS command to list the nodes that are running. What are they?</li>
<li>Use a ROS command to list the topics that exist. What are they?</li>
<li>Use a ROS command to determine the frequency of the <code>/turtle1/cmd_vel</code> topic. What is the frequency?</li>
<li>Use a ROS command to list the services that exist. What are they?</li>
<li>Use a ROS command to view information about the <code>/switch</code> service. What is its type? What node offers it?</li>
<li>Use a ROS command to list the parameters that exist. What are they?</li>
<li>Produce an image of the ROS communication graph and include it in your <code>README.md</code>. Be sure to show all topics and node labels (HINT: you can use a GUI tool to accomplish this task).</li>
<li>Use a ROS command to list the immediate dependencies of <code>crazy_turtle</code>. What are they?</li>
<li>Use a ROS command to list the service types defined by <code>crazy_turtle</code>.</li>
<li>Use a ROS command to call the <code>/switch</code> service. What does it return? What happens to the turtle when it is called? (Hint, use <code>rossrv info</code> on the type of the <code>/switch</code> service to see the parameters. Then call the service twice, once with <code>linear_velocity</code> and <code>angular_velocity</code> set to 0 and once with them at different nonzero values. You don't need to specify the exact formula used, although you can guess/look at the code to find out).</li>
<li>What is the value of the <code>/mover/velocity</code> parameter?</li>
<li>What happens to the turtle if you change <code>/mover/velocity</code> to be 10?</li>
<li>Use a ROS command to kill the <code>/mover</code> node.</li>
<li>Use a ROS command to re-run the <code>mover</code> node, being sure to remap <code>cmd_vel</code> to <code>/turtle1/cmd_vel</code>.</li>
<li>What happened to the turtle's velocity after relaunching <code>mover</code>? Why did this behavior occur?</li>
</ol>
<h1 id="part-ii-turtle-control">Part II: Turtle Control</h1>
<p>You will create a package that lets the turtle follow waypoints. From hereon out you no longer need to record the commands you use, unless otherwise specified. The package you create will depend on <code>turtlesim</code> because it is designed to control the turtle and uses messages/services from the <code>turtlesim</code> package.</p>
<ol>
<li>Create a <code>package.xml</code> and <code>CMakeLists.txt</code> in your <code>turtle_control</code> <code>git</code> repository. I recommend using <code>catkin_create_pkg</code> so you can read the comments in the generated files and learn about the formats.</li>
<li>Be sure to edit the <code>package.xml</code> to change the default but required fields to reflect your name, email, and a description of this package.</li>
<li>Commit the changes and push to the remote.</li>
<li>Add the <code>.rosinstall</code> file from your source space to your repository as <code>homework1.rosinstall</code>. Commit this file as well. In the future, anyone can duplicate your workspace by downloading <code>homework1.rosinstall</code> using <code>wstool merge</code> to download the repositories.</li>
</ol>
<h2 id="velocity-translator">Velocity Translator</h2>
<p>Write a node called <code>turtle_interpret</code> that translates a custom velocity message into a <code>geometry_msgs/Twist</code> that can be used by the <code>turtlesim</code>. The node should be placed in your package's <code>scripts</code> directory. Be sure to make your python script executable (<code>chmod 755</code>).</p>
<ol>
<li>Create a new message (in the <code>msg</code> directory) called <code>TurtleVel</code>. The message should have the following fields:
<ul>
<li><code>linear</code>: the linear velocity of the turtle</li>
<li><code>angular</code>: the angular velocity of the turtle.</li>
<li>Be sure to add comments (the <code>#</code> character begins a comment) describing the fields.</li>
<li>To properly add the message you will need to read <code>CMakeLists.txt</code> and adjust it and <code>package.xml</code>. There is a long comment block describing what you need to do.</li>
<li>The process of adding a service is nearly identical to that of adding a message.</li>
</ul></li>
<li>Make sure your package compiles with <code>catkin_make</code> and has no linting errors from <code>catkin_lint</code> before proceeding.
<ul>
<li>The errors from <code>catkin_lint</code> sometimes help explain why <code>catkin_make</code> fails.</li>
</ul></li>
<li>Write a node called <code>turtle_interpret</code> that subscribes to a topic <code>turtle_vel</code>, listening for <code>TurtleVel</code> messages. It should publish a corresponding <code>geometry_msgs/Twist</code> on <code>cmd_vel</code>.</li>
<li>In the subscription callback, log the input as a debug-level message.</li>
<li>Test the node by using ROS commands to send messages while watching the log and the <code>cmd_vel</code> topic.
<ul>
<li>To see the debugging message you will need to adjust the logger level of your node's <code>rosout</code> to debug.</li>
<li>You can use either <code>rqt_logger_level</code> or change settings in <code>rqt_console</code>.</li>
</ul></li>
<li>Add a service called <code>vel_translate</code> to your node. It converts a <code>geometry_msgs/Twist</code> into a <code>TurtleVel</code> and returns it.
<ul>
<li>Create a service file called <code>VelTranslate.srv</code> to define this service.</li>
<li>Your <code>.srv</code> will depend on the <code>geometry_msgs</code> package. You now must <code>depend</code> on this package in your <code>package.xml</code>.</li>
<li>The service should return <code>None</code> (indicating an error) if the twist has non-zero fields that don't correspond to the <code>linear</code> and <code>angular</code> velocity of a <code>TurtleVel</code></li>
<li>Your project should compile with <code>catkin_make</code> and have no <code>catkin_lint</code> errors before proceeding.</li>
</ul></li>
<li>Test the service by using ROS commands to convert a <code>geometry_msgs/Twist</code> into a <code>TurtleVel</code>.
<ul>
<li>Record one instance of the test in your <code>README.md</code>, showing the command its output.</li>
<li>Be sure to test both the error and the normal case.</li>
</ul></li>
</ol>
<h2 id="turtle-waypoint">Turtle Waypoint</h2>
<p>Write a node called <code>waypoint</code> that causes the turtle to follow a series of waypoints. The waypoints consist of a list of <code>(x,y)</code> coordinates and should be stored in a YAML file under a <code>config</code> directory in your package. A launchfile that you will write will load the trajectory into the Parameter Server. You may wish to hard-code the waypoints at first and transition to the YAML file once the rest of the code is working.</p>
<p>The trajectory that you turn in must have at least 4 non-collinear waypoints.</p>
<p>Your node should also use a private parameter called <code>dist_thresh</code>, which determines when the turtle is close enough to its destination.</p>
<ol>
<li><p>Your node should subscribe to a <code>pose</code> topic, to read the pose as reported by a turtle. It will then publish a <code>TurtleVel</code> message to <code>turtle_vel</code>. The <code>turtle_interpret</code> mode will subscribe to the <code>turtle_vel</code> topic and publish <code>cmd_vel</code> for the turtle to follow.</p>
<ul>
<li>When the node is initialized, it should use the <code>/spawn</code> service spawn a new turtle called <code>mark</code> at the first waypoint.</li>
<li>it should also read the <code>dist_thresh</code> parameter from the Parameter Server</li>
<li>Use the <code>/mark/SetPen</code> service to turn <code>mark's</code> pen off.</li>
<li>If the turtle is close (based on the thresholds) to its destination position, it should teleport <code>mark</code> to the next waypoint and start heading toward it.</li>
<li>If the final waypoint is reached, it should start from the beginning</li>
<li>Feel free to have the turtle log debugging information.</li>
<li>Especially at first, don't worry too much about performance.</li>
</ul></li>
<li><p>Write a launchfile <code>waypoint_follow.launch</code> that loads all the parameters, launches the <code>turtlesim</code>, <code>turtle_interpret</code> and <code>waypoint</code> nodes, and connects everything together to have the turtle follow the waypoints.</p></li>
<li><p>Use a ROS command line tool to capture enough <code>cmd_vel</code> commands for the turtle to visit each waypoint twice.</p>
<ul>
<li>One way to do this is to start <code>roscore</code> manually, then start the recording, then run <code>rosbag</code>. This ensures that you capture all the data from the beginning.</li>
<li>Add the bagged data as a <code>waypoint.bag</code> file to your repository.</li>
</ul></li>
<li><p>Kill the <code>turtle_interpret</code> node to stop the turtle from moving.</p></li>
<li><p>Reset the turtle to its initial configuration using a service.</p></li>
<li><p>Use a ROS command line tool to play back your bagged data and make the turtle move.</p>
<ul>
<li>You should not expect the trajectory to be duplicated, due to the inexact timing with ROS bags (see <a href="http://wiki.ros.org/rosbag/Tutorials/Recording%20and%20playing%20back%20data#The_limitations_of_rosbag_record.2BAC8-play">here</a>)</li>
</ul></li>
<li><p>Install <code>simplescreenrecorder</code> (via <code>apt</code>) or different screen recording software and use it to create a video of your code working.</p></li>
<li><p>Upload your video to a sharing website, and include a link in your <code>README.md</code></p>
<ul>
<li>Alternatively, you can include your video in your git repository or Northwestern box (as long as I can access it), but you should still link to it in your <code>README.md</code>.</li>
</ul></li>
</ol>
</div>
</div>
</div>
</div>

</body>
</html>
