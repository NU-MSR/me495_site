<!-- Generated with pandoc -D html
Modified by Matthew Elwin.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<title>Homework 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
<![endif]-->
<style type="text/css">
/*
Matthew Elwin
css for the nume template for making websites

Contains code modified from with https://gist.github.com/killercup/5917178
Mostly using the aesthetics from above, but added a table of contents menu to the left.
When printing, the menu will be hidden

*/


nav#TOC{
    width: 20%;
    height: 100%;
    position:fixed!important;
    z-index:1;
    overflow:auto;
    padding-right: 2em;
}

.home_up{
    position: fixed;
    right: 0.25em;
    top: 0.25em;
}
.content{
    margin-left: 21%;
    padding-left: 4em;
}

.inner{
    margin: 0 auto;
    min-width: 30em;
    max-width: 50em;
}

.no-foot{
    min-height: 100vh 
}

.container:after,.container:before{content:"";display:table;clear:both}

.footer {
    font-size: 9pt
}

html {
  font-size: 100%;
  overflow-y: scroll;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  padding: 0;
}

body {
  font-family: "DejaVu Serif", Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
  font-size: 12px;
  line-height: 1.7;
  padding: 1em;
  background: #fefefe;
}

a {
  color: #0645ad;
  text-decoration: none;
}

a:visited {
  color: #0b0080;
}

nav a:visited {
    color: #0645ad;
}

a:hover {
  color: #06e;
}

nav a:hover {
    color: #0645ad;
    background: #C3C3DE
}

a:active {
  color: #faa700;
}

a:focus {
  outline: thin dotted;
}

*::-moz-selection {
  background: rgba(255, 255, 0, 0.3);
  color: #000;
}

*::selection {
  background: rgba(255, 255, 0, 0.3);
  color: #000;
}

a::-moz-selection {
  background: rgba(255, 255, 0, 0.3);
  color: #0645ad;
}

a::selection {
  background: rgba(255, 255, 0, 0.3);
  color: #0645ad;
}

p {
  margin: 1em 0;
}

img {
  max-width: 100%;
}

h1, h2, h3, h4, h5, h6 {
  color: #111;
  line-height: 125%;
  margin-top: 1em;
  font-weight: normal;
}

h4, h5, h6 {
  font-weight: bold;
}

h1 {
  font-size: 2.5em;
}

h1.title {
    margin-top: 0em;
    font-size: 3em;
}

h2 {
  font-size: 2em;
}

h3 {
  font-size: 1.5em;
}

h4 {
  font-size: 1.2em;
}

h5 {
  font-size: 1em;
}

h6 {
  font-size: 0.9em;
}

blockquote {
  color: #666666;
  margin: 0;
  padding-left: 3em;
  border-left: 0.5em #EEE solid;
}

hr {
  display: block;
  height: 2px;
  border: 0;
  border-top: 1px solid #aaa;
  border-bottom: 1px solid #eee;
  margin: 1em 0;
  padding: 0;
}

pre, code, kbd, samp {
    color: #000;
    background-color: #f0f0f0;
  border: 1px solid #e1e4e5;
  font-family: monospace, monospace;
  _font-family: 'courier new', monospace;
  font-size: 0.98em;
}

.line-block {
    color: #000;
    background-color: #f0f0f0;
    border: 1px solid #e1e4e5;
}
/* this style is used for inline code blocks 
it is overwridden when inside a pre format block*/
code {
    padding: 0 5px;
    white-space: nowrap;
    font-size: 85%
}

pre {
  white-space: pre;
  white-space: pre-wrap;
  word-wrap: break-word;
}

pre code {
    padding: 0 0;
    white-space: inherit;
    border: 0
}

b, strong {
  font-weight: bold;
}

dfn {
  font-style: italic;
}

ins {
  background: #ff9;
  color: #000;
  text-decoration: none;
}

mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

sub, sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

ul, ol {
  margin: 1em 0;
  padding: 0 0 0 2em;
}

li > ul, li > ol {
    margin: 0 0;
}

nav ul, nav ol {
    list-style: none;
    padding: 0 0 0 0;
}

/* make the top level list item in table of contents not indent*/
nav li > ul, nav li > ol {
    list-style: none;
    padding: 0 0 0 2em;
}

li p:last-child {
  margin-bottom: 0;
}

ul ul, ol ol {
  margin: .3em 0;
}

dl {
  margin-bottom: 1em;
}

dt {
  font-weight: bold;
  margin-bottom: .8em;
}

dd {
  margin: 0 0 .8em 2em;
}

dd:last-child {
  margin-bottom: 0;
}

img {
  border: 0;
  -ms-interpolation-mode: bicubic;
  vertical-align: middle;
}

figure {
  display: block;
  text-align: center;
  margin: 1em 0;
}

figure img {
  border: none;
  margin: 0 auto;
}

figcaption {
  font-size: 0.8em;
  font-style: italic;
  margin: 0 0 .8em;
}

table {
  margin-bottom: 2em;
  border-bottom: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-spacing: 0;
  border-collapse: collapse;
}

table th {
  padding: .2em 1em;
  background-color: #eee;
  border-top: 1px solid #ddd;
  border-left: 1px solid #ddd;
}

table td {
  padding: .2em 1em;
  border-top: 1px solid #ddd;
  border-left: 1px solid #ddd;
  vertical-align: top;
}

.author {
  font-size: 1.2em;
}

/* When the screen gets too narrow, hide the toc*/
@media only screen and (max-width: 768px) {
    nav {
        visibility: hidden
    }
    .content {
        margin-left: 0;
    }
}

@media only screen and (min-width: 480px) {
  body {
      font-size: 14px;
  }
}
@media only screen and (min-width: 768px) {
  body {
    font-size: 16px;
  }
}
@media print {
  * {
    background: transparent !important;
    color: black !important;
    filter: none !important;
    -ms-filter: none !important;
  }

  nav {
      visibility: hidden;
  }

  .content{
      margin-left: 0%;
      padding-left: 10px;
  }

  body {
    font-size: 10pt;
    max-width: 100%;
  }

  a, a:visited {
    text-decoration: underline;
  }

  hr {
    height: 1px;
    border: 0;
    border-bottom: 1px solid black;
  }

  a[href]:after {
    content: " (" attr(href) ")";
  }

  abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
    content: "";
  }

  pre, blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  tr, img {
    page-break-inside: avoid;
  }

  img {
    max-width: 100% !important;
  }

  @page :left {
    margin: 15mm 20mm 15mm 10mm;
}

  @page :right {
    margin: 15mm 10mm 15mm 20mm;
}

  p, h2, h3 {
    orphans: 3;
    widows: 3;
  }

  h2, h3 {
    page-break-after: avoid;
  }
}


</style>
</head>
<body>

<!-- Sidebar for table of contents -->
<nav id="TOC" role="doc-toc">
<h3>Table of Contents</h3>
<ul>
<li><a href="#logistics">Logistics</a><ul>
<li><a href="#setup-and-documentation">Setup and Documentation</a></li>
<li><a href="#git-usage">Git Usage</a></li>
<li><a href="#coding-guidelines">Coding Guidelines</a></li>
<li><a href="#submission-instructions">Submission Instructions</a></li>
<li><a href="#grading">Grading</a></li>
</ul></li>
<li><a href="#turtle-trajectory">Turtle Trajectory</a><ul>
<li><a href="#git">Git</a></li>
<li><a href="#what-to-turn-in">What to turn in:</a></li>
<li><a href="#hints">Hints</a></li>
</ul></li>
<li><a href="#the-next-two-sections-are-subject-to-change-until-saturday.">The next two sections are subject to change until Saturday.</a></li>
<li><a href="#robot-arm">Robot ARM</a><ul>
<li><a href="#what-to-turn-in-1">What to turn in</a></li>
</ul></li>
<li><a href="#two-armed-xacro">Two Armed Xacro</a></li>
</ul>
</nav>

<nav class="home_up">
  <a href="index.html">Home</a>
</nav>
<div class="content">
  <div class="inner">
    <div class="no-foot">
<!-- Put the header to the right of the table of contents -->
<header id="title-block-header">
<h1 class="title">Homework 2</h1>
</header>

<!-- The main content of the file -->
<h1 id="logistics">Logistics</h1>
<p>This homework contains several tasks that will all be completed in a single git repository corresponding to a single ROS package.</p>
<h2 id="setup-and-documentation">Setup and Documentation</h2>
<ol>
<li>Create a git repository using the link provided in Canvas. This repository will contain your <code>README.md</code> and the package you create.
<ul>
<li>You will also be practicing branching in git during this homework.</li>
</ul></li>
<li>Your <code>README.md</code> should contain the following:
<ol>
<li>YOUR FULL NAME.</li>
<li>A section for each of the three main tasks: Turtle Trajectory, Robot ARM, and Two Armed Xacro. These sections should provide an overview of the files needed to run your code for that section, answer any questions, include any requested documentation or links to videos, etc.</li>
<li>Format your <code>README.md</code> using markdown: see <a href="https://guides.github.com/features/mastering-markdown/">this guide</a>. Some text editors like <code>atom</code> or <code>vscode</code> will preview markdown for you locally. You can also use tools like <code>markdown</code> or <code>pandoc</code> to generate <code>.html</code> from <code>.md</code> files.</li>
</ol></li>
<li>Each node that you write should start with a python docstring describing its ROS API:
<ol>
<li>What topics are published, their type, and what they do.</li>
<li>What topics are subscribed to, their type, and what the data is used for.</li>
<li>What services are offered, their type, and what they do</li>
<li>What parameters are used, their type, and what they do.</li>
<li>Take inspiration from <code>crazy_turtle/mover</code> (the package you will examine).</li>
</ol></li>
</ol>
<h2 id="git-usage">Git Usage</h2>
<p>During this assignment, pay close attention to how you use <code>git</code>.</p>
<ol>
<li>You should have multiple commits with meaningful commit messages.</li>
<li>For the purposes of this class, anytime you code something, try it out, and have fixed any obvious (to you) errors is a good time to commit.
<ul>
<li>Committing often frees you to experiment while knowing you can always revert the code.</li>
</ul></li>
<li>Maintain a <code>.gitignore</code> file to prevent improperly tracked files.
<ol>
<li>There should be no backup files your text editor created (such as <code>file.py~</code> or <code>.#file</code>).</li>
<li>There should be no python bytecode files (<code>file.pyc</code>) committed.</li>
<li>There should be no files that are not explicitly created by you as part of your package. There may be explicit exceptions to this for the purpose of submitting your results to me.</li>
</ol></li>
<li>Refer to the <a href="https://git-scm.com">Git Book</a> for more information on how to use <code>git.</code></li>
<li>I recommend sticking with the command line, at least until you are comfortable with <code>git.</code></li>
</ol>
<h2 id="coding-guidelines">Coding Guidelines</h2>
<ol>
<li>You are not permitted to use ANY global variables in your final submission.</li>
<li>You should try to follow the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> Style guidelines.</li>
<li>It is also a good habit to write docstrings for each of the classes and functions you write.
<ul>
<li>A brief description of what the class or function does</li>
<li>What the arguments are</li>
<li>What the return value is</li>
<li>What exceptions may be raised</li>
<li>See the <a href="http://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a> (specifically the section on docstrings).</li>
</ul></li>
</ol>
<h2 id="submission-instructions">Submission Instructions</h2>
<p>Push your package to the remote <code>git</code> repository that was created from the GitHub classroom link. Be sure your latest work is on the <code>master</code> branch.</p>
<h2 id="grading">Grading</h2>
<p>You will be graded based on</p>
<ol>
<li>Your source code working.</li>
<li>Your <code>README.md</code> and your answers to the questions.</li>
<li>The documentation you include in your source code.</li>
<li>Your git usage.</li>
</ol>
<h1 id="turtle-trajectory">Turtle Trajectory</h1>
<p>The turtle in <code>turtlesim</code> can be modeled as a kinematic car (also known as a unicycle model). The control inputs for the turtle are the linear velocity <span class="math inline">\(v\)</span> and the angular velocity <span class="math inline">\(\omega\)</span> and result in motion according to <span class="math display">\[
\dot{x} = v \cos \theta \\
\dot{y} = v \sin \theta \\
\dot{\theta} = \omega.
\]</span></p>
<p>Your goal is to make the turtle follow a circular trajectory <span class="math display">\[
x_d(t) = r \cos \frac{2 \pi t}{T} + C_x\\
y_d(t) = r \sin \frac{2 \pi t}{T} + C_y,
\]</span> where <span class="math inline">\(T\)</span> is the time to finish one circle, <span class="math inline">\((C_x, C_y)\)</span> is the center of the circle, and <span class="math inline">\(r\)</span> is the radius of the circle.</p>
<h2 id="git">Git</h2>
<ul>
<li>Develop this problem on a branch called "turtle". You can also use other feature branches if you want, but you should merge them into turtle and delete them when done.</li>
<li>Be sure to push your turtle branch to the remote so I can see it.</li>
<li>When you are done with this task, merge your turtle changes into master.</li>
</ul>
<h2 id="what-to-turn-in">What to turn in:</h2>
<ol>
<li>A node that causes turtle1 to move in a circular trajectory.
<ul>
<li>The node should also respond to a service that pauses/resumes the motion of the turtle.</li>
</ul></li>
<li>A launchfile that starts the turtle simulation and the node that moves the turtle
<ul>
<li>The launchfile should include an option to run rqt<sub>plot</sub> and show the turtle's x and y position vs time</li>
</ul></li>
<li>Use a <code>circle.yaml</code> file to stores the parameters that define the trajectory (<span class="math inline">\(T\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(C_x\)</span>, and <span class="math inline">\(C_y\)</span>). Your launchfile should load these values from your <code>circle.yaml</code> and the <code>traj_gen</code> node should load these values from the parameter server and use them to follow the trajectory.</li>
<li>An explanation of how to use your code in your <code>README.md</code></li>
<li>A screencast of your turtle completing one full circle (you choose the parameters and store them in <code>circle.yaml</code>). The turtle should be paused once during the trajectory. Upload the screencast and link to it in your <code>README.md</code>.</li>
<li>Include a write-up of any math you did to accomplish the task. This can be made with latex as a pdf, a scanned copy of handwritten notes. It is also helpful to refer to your calculations in comments where you implement the math.</li>
<li>A screenshot from <code>rqt_plot</code> showing the x and y position of the turtle over time.</li>
</ol>
<h2 id="hints">Hints</h2>
<ol>
<li>To accomplish this task, you will take advantage of the <em>differential flattness</em> property of the system. Feel free to research on your own and cite any sources. I provide a practical guide below. The goal is to express the control inputs <span class="math inline">\(v\)</span> and <span class="math inline">\(\omega\)</span> in terms of the trajectory and it's derivatives.</li>
<li>We want to solve for <span class="math inline">\(v\)</span> and <span class="math inline">\(\omega\)</span>, given the desired trajectory. Some hints are below
<ol>
<li>Use the turtle motion equations to solve for <span class="math inline">\(\theta\)</span> in terms of <span class="math inline">\(\dot{x}\)</span> and <span class="math inline">\(\dot{y}\)</span> (and eliminate <span class="math inline">\(v\)</span>).</li>
<li>Differentiate the trajectory with respect to <span class="math inline">\(t\)</span>, to give you the desired <span class="math inline">\(\dot{x}\)</span> and <span class="math inline">\(\dot{y}\)</span> values.</li>
<li>You will also need the second derivative of the reference trajectory with respect to <span class="math inline">\(t\)</span>.</li>
<li>You can use your equation for <span class="math inline">\(\theta\)</span> and the dynamic equations to solve for <span class="math inline">\(v\)</span>
<ul>
<li>There are two equivalent equations for <span class="math inline">\(v\)</span>. Both have a singularity (divide-by-zero) at some angles of <span class="math inline">\(\theta\)</span></li>
<li>By substituting your equation for <span class="math inline">\(\theta\)</span> into each of these equations and simplifying, you can show that these two equations are the same and also remove the divide-by-zero singularity.</li>
</ul></li>
<li>Use the reference trajectory derivatives to solve for <span class="math inline">\(\theta\)</span>.</li>
<li>Substitute the equation for <span class="math inline">\(\theta\)</span> into the dynamics to solve for <span class="math inline">\(v\)</span></li>
<li>Differentiate the equation for <span class="math inline">\(\theta\)</span> to find <span class="math inline">\(\omega\)</span></li>
<li>You should now have equations for <span class="math inline">\(v\)</span> and <span class="math inline">\(\omega\)</span> in terms of <span class="math inline">\(t\)</span>.</li>
<li>You may also need the second derivatives of the trajectory to find <span class="math inline">\(\omega\)</span>, depending on how you derive the equations.</li>
<li>If you write functions to compute each of the derivatives, you can break your code into smaller pieces to make it easier to debug and test.</li>
</ol></li>
<li>Use a timer running at a specified frequency to publish the velocity commands to the turtle.
<ul>
<li>Since the trajectory is continuous but you are sending discrete commands, you need the timer to publish fast enough relative to the turtle's speed to follow the circle effectively.</li>
</ul></li>
<li>When your node starts up, it should teleport the turtle to a position at the beginning of the trajectory</li>
</ol>
<h1 id="the-next-two-sections-are-subject-to-change-until-saturday.">The next two sections are subject to change until Saturday.</h1>
<h1 id="robot-arm">Robot ARM</h1>
<p>In this section you will be creating a URDF for the robot arm shown below, visualizing it in rviz, and then making it follow trajectories.</p>
<figure>
<img src="./twolink.png" alt="A 2 - link robot arm. The length of the upper and lower links are L_1 and L_2." /><figcaption>A 2 - link robot arm. The length of the upper and lower links are <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_2\)</span>.</figcaption>
</figure>
<h2 id="what-to-turn-in-1">What to turn in</h2>
<p>Note: this is just a list of what to turn in, it is not necessarily ordered by what you should do first.</p>
<ol>
<li><p>A urdf file for the robot arm. Each arm should be a different color when displayed in <code>rviz</code>. Choose <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_2\)</span> such that <span class="math inline">\(L_1 \neq L_2\)</span>.</p>
<ul>
<li>When <span class="math inline">\(\theta_1 = 0\)</span> and <span class="math inline">\(\theta_2 = 0\)</span>, the robot should be completely horizontal.</li>
<li>The model is purely kinematic, so no need to worry about inertias or collisions.</li>
<li>No need to worry about joint limits.</li>
<li>There should be a frame at the location of the robot's end-effector.</li>
</ul></li>
<li><p>A launchfile that uses the <code>robot_state_publisher</code> to publish the transforms for the arm and a <code>joint_state_publisher</code>.</p>
<ul>
<li>It should have an argument to choose between launching the <code>joint_state_publisher</code> with the <code>_use_gui</code> parameter set or not launching the <code>joint_state_publisher</code> at all.</li>
<li>It should have an argument to optionally launch rviz.</li>
<li>If rviz is loaded, you should use the <code>-d</code> option to load a <code>.rviz</code> configuration file that you create to set up the fixed frame properly and make.</li>
<li>The <code>.rviz</code> file should be provided as an argument that has a default value of the file that you create for this purpose.</li>
</ul></li>
<li><p>A node that causes the end-effector to track the following figure trajectory: <span class="math display">\[
  x_d(t) = r \cos(\frac{2\pi\theta}{T}) + c_x
  y_d(t) = r \cos(\frac{4\pi\theta}{T})
  \]</span></p></li>
<li><p>A node that listens to the end-effector position and draws spherical markers in <code>rviz</code>. The markers should fade away before the robot completes one cycle of the trajectory. You likely will need to publish these markers at a significantly slower rate than the trajectory because they can be slow to process.</p></li>
<li><p>A node that broadcasts a frame that the base of the arm is attached to. This frame should be connected to the <code>tf</code> tree in such away that moving the frame moves the whole base of the arm.</p>
<ul>
<li>Using an interactive marker in rviz, you should be able to interactively change the position and orientation of the whole arm while the arm is following the trajectory.</li>
</ul></li>
<li><p>A launchfile that includes the launchfile from step 2 to launch rviz, the robot<sub>statepublisher</sub> and also has the following features:</p>
<ul>
<li>An option to either load the joint<sub>statepublisher</sub> with a gui or load your trajectory generation node.</li>
<li>An option to load the node that sends the spherical markers to rviz, only if your trajectory generation node is also loaded</li>
<li>An option to load the node that uses the interactive marker and broadcasts a frame. If this option is selected, a different <code>.rviz</code> configuration file should be loaded because your fixed frame will be different.</li>
</ul></li>
<li><p>A discussion in your <code>README.md</code> about what each launchfile and node is called and what it does. Comments in the docstring of each node should describe the ROS api for each node (publishers, subscribers, services, etc.).</p></li>
</ol>
<h1 id="two-armed-xacro">Two Armed Xacro</h1>
<ol>
<li>Create a <code>.xacro</code> file based on the URDF in the previous section, that allows you to read the length of each arm from a <code>.yaml</code> file</li>
<li>Create another <code>.xacro</code> file that uses the <code>.xacro</code> file from step 1 to create a robot with two planar arms. The two arms should be y<span class="math inline">\(\frac{L_1 + L_2}{2}\)</span> distance apart and face in opposite directions. They are fixed to a rotational link that rotates about the <span class="math inline">\(z\)</span> axis, but has upper and lower joint limits of <span class="math inline">\(-45^\circ\)</span> to <span class="math inline">\(45^\circ\)</span>.</li>
<li>Write a launch file that converts your <code>.xacro</code> file into a <code>urdf</code>, loads it using the robot<sub>statepublisher</sub>, and loads a <code>joint_state_publisher</code> with the gui. The launchfile should load an <code>.rviz</code> file so that it is easy to see the arm you created. You should be able to use the <code>joint_state_publisher</code> gui to move the robot around.</li>
<li>Be sure to describe the files you added in your <code>README.md</code></li>
</ol>
</div>
</div>
</div>
</div>

</body>
</html>
